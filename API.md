# Endpoints - v0.3 (discuss at [#34](https://github.com/Pikne-Programy/pikne-zadania/issues/34)) <!-- omit in toc -->

If there is an error (`4xx` or `5xx` status code), the API will return either no content or the JSON object with an error message:

```json
{
  "msg": "<error message>"
}
```

The common errors status codes are:
- 400, when the request is invalid,
- 401, when the authentication has failed or is required and is not provided,
- 500, if there is a problem on the server-side.

## TODO <!-- omit in toc -->

- add a possibility to upload images
- add subject category (tag) modification

## Table of Contents <!-- omit in toc -->

- [Exercise](#exercise)
  - [`POST /api/exercise/list`](#post-apiexerciselist)
  - [`POST /api/exercise/render`](#post-apiexerciserender)
  - [`POST /api/exercise/check`](#post-apiexercisecheck)
- [Subject](#subject)
  - [`GET /api/subject/list`](#get-apisubjectlist)
  - [`POST /api/subject/create`](#post-apisubjectcreate)
  - [`POST /api/subject/info`](#post-apisubjectinfo)
  - [`POST /api/subject/permit`](#post-apisubjectpermit)
- [Exercise modification](#exercise-modification)
  - [`POST /api/subject/exercise/list`](#post-apisubjectexerciselist)
  - [`POST /api/subject/exercise/add`](#post-apisubjectexerciseadd)
  - [`POST /api/subject/exercise/get`](#post-apisubjectexerciseget)
  - [`POST /api/subject/exercise/update`](#post-apisubjectexerciseupdate)
  - [`POST /api/subject/exercise/preview`](#post-apisubjectexercisepreview)
- [Auth](#auth)
  - [`POST /api/auth/register`](#post-apiauthregister)
  - [`POST /api/auth/login`](#post-apiauthlogin)
  - [`POST /api/auth/logout`](#post-apiauthlogout)
- [User](#user)
  - [`POST /api/user/info`](#post-apiuserinfo)
  - [`POST /api/user/update`](#post-apiuserupdate)
  - [`POST /api/user/delete`](#post-apiuserdelete)
- [Team](#team)
  - [`GET /api/team/list`](#get-apiteamlist)
  - [`POST /api/team/create`](#post-apiteamcreate)
  - [`POST /api/team/info`](#post-apiteaminfo)
  - [`POST /api/team/update`](#post-apiteamupdate)
  - [`POST /api/team/delete`](#post-apiteamdelete)


<sub><sup><i><a href='https://magnetikonline.github.io/markdown-toc-generate/'>Table of Contents generated by magnetikonline/markdown-toc-generate</a></i></sup></sub>

## Exercise

### `POST /api/exercise/list`

| Method | URL                  | Description                    | Special status codes |
| ------ | -------------------- | ------------------------------ | -------------------- |
| POST   | `/api/exercise/list` | get all exercises from subject | 404                  |

**Request**:

```json
{
  "id": "fizyka"
}
```

**Response**:

```json
[
  {
    "name": "mechanika",
    "children": [
      {
        "name": "kinematyka",
        "children": [
          {
            "name": "Pociągi dwa",
            "children": "pociagi-dwa",
            "done": 0.34
          }
        ]
      }
    ]
  }
]
```

**note**: `done` property is stated only when the user is authorized, it can be `null` or a number from 0 up to and including 1, see [#24](https://github.com/Pikne-Programy/pikne-zadania/issues/24#issuecomment-782939873).

---

### `POST /api/exercise/render`

| Method | URL                    | Description        | Special status codes |
| ------ | ---------------------- | ------------------ | -------------------- |
| POST   | `/api/exercise/render` | render an exercise | 403, 404             |

**Request**:

```json
{
  "id": "fizyka/pociagi-dwa",
  "seed": 0
}
```

**Response**:

```json
// Student version
{
  "type": "EqEx",
  "name": "Pociągi dwa 2",
  "done": 0.34,
  "content": {
    "main": "Z miast \\(A\\) i \\(B\\) odległych o \\(d=300\\;\\mathrm{km}\\) wyruszają jednocześnie\ndwa pociągi z prędkościami \\(v_a= 50\\;\\mathrm{\\frac{km}{h}}\\) oraz \\(v_b=70\\;\\mathrm{\\frac{km}{h}}\\).\nW jakiej odległości \\(x\\) od miasta \\(A\\) spotkają się te pociągi?\nPo jakim czasie \\(t\\) się to stanie?",
    "img": ["1.png", "2.png"],
    "unknowns": [
      ["x", "\\mathrm{km}"],
      ["t", "\\mathrm{s}"]
    ]
  }
}

// Teacher/Admin version
{
  "type": "EqEx",
  "name": "Pociągi dwa 2",
  "content": {
    "main": "Z miast \\(A\\) i \\(B\\) odległych o \\(d=300\\;\\mathrm{km}\\) wyruszają jednocześnie\ndwa pociągi z prędkościami \\(v_a= 50\\;\\mathrm{\\frac{km}{h}}\\) oraz \\(v_b=70\\;\\mathrm{\\frac{km}{h}}\\).\nW jakiej odległości \\(x\\) od miasta \\(A\\) spotkają się te pociągi?\nPo jakim czasie \\(t\\) się to stanie?",
    "img": ["1.png", "2.png"],
    "unknowns": [
      ["x", "\\mathrm{km}"],
      ["t", "\\mathrm{s}"]
    ],
    "correct": [2.5, 125]
  }
}
```

**note**: `content` is ExT-dependent, shown above is the EqEx one. \
**note**: The content can contain links to static content. It can be accessed via `GET /img/:subject/:file` request. \
**note**: User will receive `done` only if authorized as Student. \
**note**: User will receive `correct` only if authorized as teacher or admin. \
**note**: `seed` property is optional. It may be given if a user is authorized as a teacher or admin. For students, it will be taken from a database. \
**note**: With this request, it is NOT possible to access private exercises (if authorized as Student). See [`POST /api/exam/render`](#post-apiexamrender).

---

### `POST /api/exercise/check`

| Method | URL                   | Description   | Special status codes |
| ------ | --------------------- | ------------- | -------------------- |
| POST   | `/api/exercise/check` | check answers | 404                  |

**Request**:

```json
{
  "id": "fizyka/pociagi-dwa",
  "answers": [15.000000000000004, 13]
}
```

**Response**:

```json
[false, true]
```

**note**: It's ExT-dependent, what is shown above is appropriate for the EqEx one.

---

## Subject

### `GET /api/subject/list`

| Method | URL                 | Description                | Special status codes |
| ------ | ------------------- | -------------------------- | -------------------- |
| GET    | `/api/subject/list` | fetch list of all subjects | 403                  |

**Request**:

```json

```

**Response**:

```json
[
  "fizyka",
  "_fizyka",
  "astronomia"
]
```

**note**: Subjects with `_` prefix are private (are not visible to unauthorized users). \
**note**: Only subjects that the current user can modifiy will be fetched.

---

### `POST /api/subject/create`

| Method | URL                   | Description        | Special status codes         |
| ------ | --------------------- | ------------------ | ---------------------------- |
| POST   | `/api/subject/create` | create new subject | 403, 409 (id already exists) |

**Request**:

```json
{
  "id": "astronomia",
  "users": ["e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"]
}
```

**Response**:

```json

```

**note**: Subject `id` is its name, it has to be unique. \
**note**: The subject will be public if `users` is `null` or is omitted.

---

### `POST /api/subject/info`

| Method | URL                 | Description                  | Special status codes |
| ------ | ------------------- | ---------------------------- | -------------------- |
| POST   | `/api/subject/info` | get list of authorized users | 403, 404             |

**Request**:

```json
{
  "id": "astronomia"
}
```

**Response**:

```json
[
  {
    "id": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
    "name": "User"
  }
]
```

---

### `POST /api/subject/permit`

| Method | URL                   | Description                     | Special status codes |
| ------ | --------------------- | ------------------------------- | -------------------- |
| POST   | `/api/subject/permit` | change list of authorized users | 403, 404             |

**Request**:

```json
{
  "id": "astronomia",
  "users": [
    {
      "id": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "name": "User"
    }
  ]
}
```

**Response**:

```json

```

---

## Exercise modification

### `POST /api/subject/exercise/list`

| Method | URL                          | Description                                      | Special status codes |
| ------ | ---------------------------- | ------------------------------------------------ | -------------------- |
| POST   | `/api/subject/exercise/list` | get all exercises with descriptions from subject | 403, 404             |

**Request**:

```json
{
  "id": "_fizyka"
}
```

**Response**:

```json
[
  {
    "name": "mechanika",
    "children": [
      {
        "name": "kinematyka",
        "children": [
          {
            "type": "EqEx",
            "name": "Pociągi dwa",
            "children": "pociagi-dwa",
            "desc": "Z miast \\(A\\) i \\(B\\) odległych o \\(d=300\\;\\mathrm{km}\\) wyruszają jednocześnie\ndwa pociągi z prędkościami \\(v_a= 50\\;\\mathrm{\\frac{km}{h}}\\) oraz \\(v_b=70\\;\\mathrm{\\frac{km}{h}}\\).\nW jakiej odległości \\(x\\) od miasta \\(A\\) spotkają się te pociągi?\nPo jakim czasie \\(t\\) się to stanie?"
          }
        ]
      }
    ]
  }
]
```

---

### `POST /api/subject/exercise/add`

| Method | URL                         | Description      | Special status codes         |
| ------ | --------------------------- | ---------------- | ---------------------------- |
| POST   | `/api/subject/exercise/add` | add new exercise | 403, 409 (id already exists) |

**Request**:

```json
{
  "id": "fizyka/pociagi-dwa-2",
  "content": "---\ntype: EqEx\nname: Pociągi dwa\n---\nZ miast \\(A\\) i \\(B\\) odległych o d=300km wyruszają jednocześnie\ndwa pociągi z prędkościami v_a=[40;60]km/h oraz v_b=[60;80]km/h.\nW jakiej odległości x=?km od miasta \\(A\\) spotkają się te pociągi?\nPo jakim czasie t=?h się to stanie?\n---\nt=d/(v_a+v_b)\nx=t*v_a\n"
}
```

**Response**:

```json

```

**note**: `content` is ExT-dependent, shown above is the EqEx one. 

---

### `POST /api/subject/exercise/get`

| Method | URL                         | Description                | Special status codes |
| ------ | --------------------------- | -------------------------- | -------------------- |
| POST   | `/api/subject/exercise/get` | get content of an exercise | 403, 404             |

**Request**:

```json
{
  "id": "fizyka/pociagi-dwa"
}
```

**Response**:

```json
{
  "content": "---\ntype: EqEx\nname: Pociągi dwa\n---\nZ miast \\(A\\) i \\(B\\) odległych o d=300km wyruszają jednocześnie\ndwa pociągi z prędkościami v_a=[40;60]km/h oraz v_b=[60;80]km/h.\nW jakiej odległości x=?km od miasta \\(A\\) spotkają się te pociągi?\nPo jakim czasie t=?h się to stanie?\n---\nt=d/(v_a+v_b)\nx=t*v_a\n"
}
```

**note**: `content` is ExT-dependent, shown above is the EqEx one.

---

### `POST /api/subject/exercise/update`

| Method | URL                            | Description               | Special status codes |
| ------ | ------------------------------ | ------------------------- | -------------------- |
| POST   | `/api/subject/exercise/update` | update exercise's content | 403, 404             |

**Request**:

```json
{
  "id": "fizyka/pociagi-dwa",
  "content": "---\ntype: EqEx\nname: Pociągi dwa\n---\nZ miast \\(A\\) i \\(B\\) odległych o d=300km wyruszają jednocześnie\ndwa pociągi z prędkościami v_a=[40;60]km/h oraz v_b=[60;80]km/h.\nW jakiej odległości x=?km od miasta \\(A\\) spotkają się te pociągi?\nPo jakim czasie t=?h się to stanie?\n---\nt=d/(v_a+v_b)\nx=t*v_a\n"
}
```

**Response**:

```json

```

**note**: `content` is ExT-dependent, shown above is the EqEx one. \
**note**: Only content can be changed, changing id will make a new exercise.

---

### `POST /api/subject/exercise/preview`

| Method | URL                             | Description         | Special status codes |
| ------ | ------------------------------- | ------------------- | -------------------- |
| POST   | `/api/subject/exercise/preview` | preview an exercise | 403, 404             |

**Request**:

```json
{
  "content": "---\ntype: EqEx\nname: Pociągi dwa\n---\nZ miast \\(A\\) i \\(B\\) odległych o d=300km wyruszają jednocześnie\ndwa pociągi z prędkościami v_a=[40;60]km/h oraz v_b=[60;80]km/h.\nW jakiej odległości x=?km od miasta \\(A\\) spotkają się te pociągi?\nPo jakim czasie t=?h się to stanie?\n---\nt=d/(v_a+v_b)\nx=t*v_a\n",
  "seed": 0
}
```

**Response**:

```json
{
  "type": "EqEx",
  "name": "Pociągi dwa 2",
  "content": {
    "main": "Z miast \\(A\\) i \\(B\\) odległych o \\(d=300\\;\\mathrm{km}\\) wyruszają jednocześnie\ndwa pociągi z prędkościami \\(v_a= 50\\;\\mathrm{\\frac{km}{h}}\\) oraz \\(v_b=70\\;\\mathrm{\\frac{km}{h}}\\).\nW jakiej odległości \\(x\\) od miasta \\(A\\) spotkają się te pociągi?\nPo jakim czasie \\(t\\) się to stanie?",
    "img": ["1.png", "2.png"],
    "unknowns": [
      ["x", "\\mathrm{km}"],
      ["t", "\\mathrm{s}"]
    ],
    "correct": [2.5, 125]
  }
}
```

**note**: `content` is ExT-dependent, shown above is the EqEx one. User not authorized as teacher or admin will not receive answers. \
**note**: The content can contain links to static content. It can be accessed via `GET /img/:subject/:file` request. \
**note**: `seed` property is optional.

---

## Auth

### `POST /api/auth/register`

| Method | URL                  | Description         | Special status codes                                 |
| ------ | -------------------- | ------------------- | ---------------------------------------------------- |
| POST   | `/api/auth/register` | register a new user | 403 (wrong invitation), 409 (account already exists) |

**Request**:

```json
{
  "login": "user@example.com",
  "name": "User",
  "hashedPassword": "r02H/fnQ3M3Xfjqsr3dg8mY78lBDXWoiR0O0JcXW8VM=",
  "number": 11,
  "invitation": "QwErTy58"
}
```

**Response**:

```json

```

**note**: The generation of `hashedPassword` is described [here](https://github.com/Pikne-Programy/pikne-zadania/issues/22#issuecomment-789536400). \
**note**: `number` is a number or `null` when it's not provided. \
**note**: `login` is an email address (the hard-coded users like `root` cannot be registered). \
**note**: The registration doesn't authenticate, there should be a `POST /api/auth/login` request afterwards.

---

### `POST /api/auth/login`

| Method | URL               | Description  | Special status codes |
| ------ | ----------------- | ------------ | -------------------- |
| POST   | `/api/auth/login` | authenticate | -                    |

**Request**:

```json
{
  "login": "user@example.com",
  "hashedPassword": "r02H/fnQ3M3Xfjqsr3dg8mY78lBDXWoiR0O0JcXW8VM="
}
```

**Response**:

```json

```

**note**: The generation of `hashedPassword` is described [here](https://github.com/Pikne-Programy/pikne-zadania/issues/22#issuecomment-789536400).

---

### `POST /api/auth/logout`

| Method | URL                | Description    | Special status codes |
| ------ | ------------------ | -------------- | -------------------- |
| POST   | `/api/auth/logout` | unauthenticate | -                    |

**Request**:

```json

```

**Response**:

```json

```

---

## User

### `POST /api/user/info`

| Method | URL              | Description           | Special status codes |
| ------ | ---------------- | --------------------- | -------------------- |
| POST   | `/api/user/info` | get info about a user | 403, 404             |

**Request**:

```json
{
  "id": "1057a9604e04b274da5a4de0c8f4b4868d9b230989f8c8c6a28221143cc5a755"
}
```

**Response**:

```json
{
  "name": "User",
  "team": 1,
  "number": 11
}
```

**note**: Providing a request object without an `id` property (i.e. an empty object) will result getting info about currently authenticated user.
**note**: `number` can be `null`.

---

### `POST /api/user/update`

| Method | URL                | Description        | Special status codes |
| ------ | ------------------ | ------------------ | -------------------- |
| POST   | `/api/user/update` | update User's data | 403, 404             |

**Request**:

```json
{
  "id": "1057a9604e04b274da5a4de0c8f4b4868d9b230989f8c8c6a28221143cc5a755",
  "number": 34
}
```

**Response**:

```json

```

**note**: Possible parameters to change are `number` and `name`. \
**note**: `number` can be `null`.

---

### `POST /api/user/delete`

| Method | URL                | Description       | Special status codes |
| ------ | ------------------ | ----------------- | -------------------- |
| POST   | `/api/user/delete` | unregister a user | 403, 404             |

**Request**:

```json
{
  "id": "1057a9604e04b274da5a4de0c8f4b4868d9b230989f8c8c6a28221143cc5a755"
}
```

**Response**:

```json

```

---

## Team


### `GET /api/team/list`

| Method | URL              | Description       | Special status codes |
| ------ | ---------------- | ----------------- | -------------------- |
| GET    | `/api/team/list` | get list of teams | 403                  |

**Request**:

```json

```

**Response**:

```json
[
  {
    "id": 1,
    "name": "Teachers",
    "assignee": "Smith",
    "invitation": "QwErTy58"
  },
  {
    "id": 2,
    "name": "2d",
    "assignee": "Williams",
    "invitation": null
  },
  {
    "id": 3,
    "name": "3d",
    "assignee": "Williams",
    "invitation": null
  }
]
```

**note**: There is always a hard-coded `admin` team with id `0`. \
**note**: There will be the `invitation` property of all teams the user can manage. \
**note**: When a team has closed registration, `invitation` is `null`.

---

### `POST /api/team/create`

| Method | URL                | Description     | Special status codes |
| ------ | ------------------ | --------------- | -------------------- |
| POST   | `/api/team/create` | create new team | 403                  |

**Request**:

```json
{
  "name": "2d"
}
```

**Response**:

```json
2
```

**note**: The response is an `id` of a team.

---

### `POST /api/team/info`

| Method | URL              | Description         | Special status codes |
| ------ | ---------------- | ------------------- | -------------------- |
| POST   | `/api/team/info` | get info about team | 403, 404             |

**Request**:

```json
{
  "id": 2
}
```

**Response**:

```json
{
  "name": "2d",
  "assignee": "Williams",
  "invitation": "QwErTy58",
  "members": [
    {
      "id": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "name": "User",
      "number": 11
    }
  ]
}
```

**note**: `id` property is a hashed email. \
**note**: When team has closed registration, `invitation` is `null`. \
**note**: Students will not receive `invitation` and `members`.

---

### `POST /api/team/update`

| Method | URL                | Description        | Special status codes                     |
| ------ | ------------------ | ------------------ | ---------------------------------------- |
| POST   | `/api/team/update` | change team's data | 403, 404, 409 (invitation code is taken) |

**Request**:

```json
{
  "id": 2,
  "invitation": "QwErTy58"
}
```

**Response**:

```json

```

**note**: Possible paramters to change are: `invitation`, `assignee`, `name`. \
**note**: `invitation` in request can also be `""` (in that case, it will be generated) or `null` (in that case, registration will be closed).

---

### `POST /api/team/delete`

| Method | URL                | Description   | Special status codes |
| ------ | ------------------ | ------------- | -------------------- |
| POST   | `/api/team/delete` | delete a team | 403, 404             |

**Request**:

```json
{
  "id": 3
}
```

**Response**:

```json

```

---
